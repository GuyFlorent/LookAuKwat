@{
    ViewBag.Title = "Home Page";
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin="" />

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>


<section>
    <ul class="nav nav-pills">
        <li class="active"><a href="#search" data-toggle="tab">Offres</a></li>
        <li><a href="#ask" data-toggle="tab">Demandes</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active fade in" id="search">
            <div id="searchJob">
                <div class="form-group">
                    <label for="selectCategory">Choisir une catégorie</label>
                    <select class="form-control searchcategory" data-show-icon="true">
                        <option>Tout</option>
                        <option data-content="<i class='glyphicon glyphicon-briefcase'></i>">Emploi</option>
                        <option data-content="<i class='glyphicon glyphicon-home'></i>">Immobilier</option>
                    </select>
                </div>
                <div id="JobId" class="hidden">
                    @{
                        Html.RenderAction("SearchOfferJob_PartialView", "JobOfferSearch");
                    }

                </div>
                Future Offres
            </div>
        </div>
        <div class="tab-pane fade " id="ask">
            <div id="askJob">
                <div class="form-group">
                    <label for="selectCategory">Choisir une catégorie</label>
                    <select class="form-control Addcategory" data-show-icon="true">
                        <option>Tout</option>
                        <option data-content="<i class='glyphicon glyphicon-briefcase'></i>">Emploi</option>
                        <option data-content="<i class='glyphicon glyphicon-home'></i>">Immobilier</option>
                    </select>
                </div>
                future demande
            </div>
        </div>
    </div>

</section>
<hr />
<section class="row">
    <section class="col-md-4">
        les pubs
    </section>
    <section id="jobSectionResult" class="col-md-4 hidden">
        <ul class="nav nav-pills ">
            <li class="active"><a href="#ResulList" data-toggle="tab">Liste</a></li>
            <li><a href="#ResultMap" data-toggle="tab">Carte</a></li>
        </ul>
        <div class="tab-content" id="resultsJobSearch">
            <div class="tab-pane active  fade in" id="ResulList">
                <div class="">
                    @{
                        Html.RenderAction("ResultSearch_PartialView", "Product");
                    }
                </div>
            </div>

            <div class="tab-pane  fade " id="ResultMap">
                <div id="mapid" style="height:480px"> </div>
            </div>
        </div>
    </section>

    <section class="col-md-4">
        les pubs
    </section>
</section>


<script type="text/javascript">

    var mymap = L.map('mapid');
    mymap.setView(["48.864716", "2.349014"], 13);


    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11', /*mapbox/satellite-v9*/
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoiZ3V5d2FuZ3VldSIsImEiOiJjazc0amN4ZzkwOG14M2twYXhpbDZ6NjRwIn0.HU_TD-k9bLv6_ctUhyIRuw'
    }).addTo(mymap);

    var options = {
        enableHighAccuracy: false,
        timeout: 5000,
        maximumAge: Infinity
    };


    navigator.geolocation.getCurrentPosition(function (position) {
        var lat = position.coords.latitude;
        var long = position.coords.longitude;
        mymap.setView([lat, long], 13);
    }, null, options)


    $(function () {

        $("select.searchcategory").change(function () {
            var select = $(this).children("option:selected").val();

            if (select == "Emploi") {
                $('#JobId').removeClass('hidden');
            } else {
                $('#JobId').addClass('hidden');
            }
        });

        $('button').click(function () {
            $('#jobSectionResult').removeClass('hidden');
            //$('#jobSectionResult').addClass('hidden');
           // alert('toto');


        })

         $("a[href='#ResultMap']").on('shown.bs.tab', function (e) {
             mymap.invalidateSize();
              $.ajax({
            type: "POST",
            url: '@Url.Action("ResultSearchOfferJob_Jason", "JobOfferSearch")',
            dataType: "json",
            headers: {
                //"api-key": searchServiceApiKey,
                "Content-Type": "application/json"
            },
            data: JSON.stringify({
               
                sector: $("#ActivitySectorJob").val(),
                town: $(".TownSearchJob").val(),
                contract: $("#TypeContractJob").val(),
                minPrice: $("#PriceMinSearch").val(),
                maxPrice: $("#PriceMaxSearch").val(),
            }),
                  success: function (data1) {
                      if (data1.success) {
                          alert("bien");
                      } else {
                          // DoSomethingElse()
                          alert("movais");
                      }           
                  },
                      //function (data1) {
                  //    alert(data1);
                  //    alert('cest bon');
                  //    //console.log(data.length);
                  //  for (var i = 0; i < data1.length; i++) {
                  //  console.log(i);
                  //  //var popup = '<b>Titre:</b>' + data[i].Title +
                  //  //    '<br/><b>Adresse:</b>' + data[i].Price + ',' + data[i].Town + ',' + data[i].Country



                  //  //L.marker([data[i].Coordinate.Lat, data[i].Coordinate.Lon])
                  //  //    .bindPopup(popup)
                  //  //    .addTo(mymap);

                  //   }
                  //   $("#mapid").html(data1);

                  //},
                  error: function (xhr) {
                      console.log(xhr.responseText);
                      alert("Une erreur est survenu  !");
                  }
              });
             
        });
    })
</script>